<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>ç®€åŒ–çš„THREE.jså†²çªæµ‹è¯•</title>
        <style>
            body { 
                margin: 0; 
                padding: 20px; 
                font-family: Arial, sans-serif;
                background: #f0f0f0;
            }
            .info { 
                background: white; 
                padding: 20px; 
                margin-bottom: 20px; 
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .success { color: #28a745; font-weight: bold; }
            .error { color: #dc3545; font-weight: bold; }
            .warning { color: #ffc107; font-weight: bold; }
            #container { 
                width: 100%; 
                height: 400px; 
                border: 2px solid #ddd;
                border-radius: 8px;
                background: #222;
            }
            .status { margin: 10px 0; }
        </style>
    </head>
    <body>
        <div class="info">
            <h2>THREE.jså¤šå®ä¾‹é—®é¢˜ç®€åŒ–æµ‹è¯•</h2>
            <p>å¦‚æœä½ çœ‹åˆ°æ§åˆ¶å°æœ‰"Multiple instances"è­¦å‘Šï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è§£å†³ï¼š</p>
            
            <div id="status-container">
                <div class="status" id="step1">ğŸ” æ­¥éª¤1: æ£€æŸ¥EngineKernelåŠ è½½çŠ¶æ€...</div>
                <div class="status" id="step2">â³ æ­¥éª¤2: ç­‰å¾…æ£€æŸ¥THREEå¯¹è±¡...</div>
                <div class="status" id="step3">â³ æ­¥éª¤3: ç­‰å¾…åˆ›å»º3Dåœºæ™¯...</div>
                <div class="status" id="step4">â³ æ­¥éª¤4: ç­‰å¾…å¯åŠ¨åŠ¨ç”»...</div>
            </div>
            
            <h3>æ‰‹åŠ¨è§£å†³æ–¹æ¡ˆï¼š</h3>
            <ol>
                <li><strong>æ£€æŸ¥å¼€å‘æœåŠ¡å™¨ï¼š</strong> ç¡®ä¿ <code>npm run dev</code> åœ¨EngineKernelç›®å½•è¿è¡Œ</li>
                <li><strong>æ¸…ç†ç¼“å­˜ï¼š</strong> æŒ‰Ctrl+Shift+Deleteæ¸…ç†æµè§ˆå™¨ç¼“å­˜</li>
                <li><strong>æ£€æŸ¥æ§åˆ¶å°ï¼š</strong> æŸ¥çœ‹å…·ä½“çš„é”™è¯¯ä¿¡æ¯</li>
                <li><strong>é‡æ–°åŠ è½½ï¼š</strong> åˆ·æ–°é¡µé¢é‡è¯•</li>
            </ol>
        </div>
        
        <canvas id="container"></canvas>
        
        <!-- å°è¯•åŠ è½½å¼€å‘ç‰ˆæœ¬ï¼Œå¦‚æœå¤±è´¥åˆ™ä½¿ç”¨minç‰ˆæœ¬ -->
        <script>
            let step1 = document.getElementById('step1');
            let step2 = document.getElementById('step2');
            let step3 = document.getElementById('step3');
            let step4 = document.getElementById('step4');
            
            function updateStatus(stepId, message, type = 'info') {
                const element = document.getElementById(stepId);
                const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'warning';
                element.innerHTML = message;
                element.className = `status ${className}`;
            }
            
            // åŠ¨æ€åŠ è½½EngineKernelè„šæœ¬
            function loadEngineKernel() {
                return new Promise((resolve, reject) => {
                    // é¦–å…ˆå°è¯•å¼€å‘ç‰ˆæœ¬
                    const devScript = document.createElement('script');
                    devScript.src = 'http://localhost:8000/engine-kernel.dev.js';
                    devScript.onload = () => {
                        updateStatus('step1', 'âœ… EngineKernelå¼€å‘ç‰ˆæœ¬åŠ è½½æˆåŠŸ', 'success');
                        resolve('dev');
                    };
                    devScript.onerror = () => {
                        console.log('å¼€å‘ç‰ˆæœ¬åŠ è½½å¤±è´¥ï¼Œå°è¯•minç‰ˆæœ¬...');
                        document.head.removeChild(devScript);
                        
                        // å°è¯•minç‰ˆæœ¬
                        const minScript = document.createElement('script');
                        minScript.src = './../../dist/engine-kernel.min.js';
                        minScript.onload = () => {
                            updateStatus('step1', 'âœ… EngineKernel minç‰ˆæœ¬åŠ è½½æˆåŠŸ', 'success');
                            resolve('min');
                        };
                        minScript.onerror = () => {
                            updateStatus('step1', 'âŒ EngineKernelåŠ è½½å¤±è´¥', 'error');
                            reject(new Error('æ— æ³•åŠ è½½EngineKernel'));
                        };
                        document.head.appendChild(minScript);
                    };
                    document.head.appendChild(devScript);
                });
            }
            
            // åˆå§‹åŒ–æµ‹è¯•
            async function initTest() {
                try {
                    // åŠ è½½EngineKernel
                    await loadEngineKernel();
                    
                    // æ£€æŸ¥THREEå¯¹è±¡
                    updateStatus('step2', 'ğŸ” æ£€æŸ¥THREEå¯¹è±¡...', 'warning');
                    
                    if (!window.EngineKernel) {
                        throw new Error('EngineKernelæœªæ­£ç¡®åŠ è½½åˆ°å…¨å±€å¯¹è±¡');
                    }
                    
                    if (!window.EngineKernel.THREE) {
                        throw new Error('EngineKernel.THREEä¸å¯ç”¨');
                    }
                    
                    const THREE = window.EngineKernel.THREE;
                    updateStatus('step2', `âœ… THREEå¯¹è±¡å¯ç”¨ï¼Œç‰ˆæœ¬: ${THREE.REVISION}`, 'success');
                    
                    // åˆ›å»º3Dåœºæ™¯
                    updateStatus('step3', 'ğŸ¨ åˆ›å»º3Dåœºæ™¯...', 'warning');
                    
                    const scene = new THREE.Scene();
                    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / 400, 0.1, 1000);
                    const renderer = new THREE.WebGLRenderer({ 
                        canvas: document.getElementById('container'),
                        antialias: true 
                    });
                    
                    renderer.setSize(window.innerWidth - 40, 400);
                    renderer.setClearColor(0x2c3e50);
                    
                    // åˆ›å»ºæ—‹è½¬ç«‹æ–¹ä½“
                    const geometry = new THREE.BoxGeometry(1.5, 1.5, 1.5);
                    const material = new THREE.MeshPhongMaterial({ 
                        color: 0x3498db,
                        shininess: 100 
                    });
                    const cube = new THREE.Mesh(geometry, material);
                    scene.add(cube);
                    
                    // æ·»åŠ å…‰æº
                    const ambientLight = new THREE.AmbientLight(0x404040, 0.4);
                    scene.add(ambientLight);
                    
                    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                    directionalLight.position.set(1, 1, 1);
                    scene.add(directionalLight);
                    
                    camera.position.z = 3;
                    
                    updateStatus('step3', 'âœ… 3Dåœºæ™¯åˆ›å»ºæˆåŠŸ', 'success');
                    
                    // å¯åŠ¨åŠ¨ç”»
                    updateStatus('step4', 'ğŸ¬ å¯åŠ¨åŠ¨ç”»...', 'warning');
                    
                    function animate() {
                        requestAnimationFrame(animate);
                        
                        cube.rotation.x += 0.01;
                        cube.rotation.y += 0.01;
                        
                        renderer.render(scene, camera);
                    }
                    
                    animate();
                    updateStatus('step4', 'âœ… åŠ¨ç”»å¯åŠ¨æˆåŠŸï¼å¦‚æœçœ‹åˆ°æ—‹è½¬ç«‹æ–¹ä½“ï¼Œè¯´æ˜ä¸€åˆ‡æ­£å¸¸ï¼', 'success');
                    
                    // æ£€æŸ¥æ˜¯å¦æœ‰è­¦å‘Š
                    setTimeout(() => {
                        console.log('ğŸ‰ æµ‹è¯•å®Œæˆï¼å¦‚æœæ§åˆ¶å°æ²¡æœ‰"Multiple instances"è­¦å‘Šï¼Œè¯´æ˜é—®é¢˜å·²è§£å†³ï¼');
                    }, 3000);
                    
                } catch (error) {
                    console.error('æµ‹è¯•å¤±è´¥:', error);
                    updateStatus('step1', `âŒ é”™è¯¯: ${error.message}`, 'error');
                    
                    // æä¾›æ•…éšœæ’é™¤å»ºè®®
                    const container = document.getElementById('status-container');
                    container.innerHTML += `
                        <div class="status error">
                            <h4>æ•…éšœæ’é™¤å»ºè®®ï¼š</h4>
                            <ul>
                                <li>ç¡®ä¿åœ¨EngineKernelç›®å½•è¿è¡Œäº† <code>npm run dev</code></li>
                                <li>æ£€æŸ¥æ§åˆ¶å°çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯</li>
                                <li>æ¸…ç†æµè§ˆå™¨ç¼“å­˜åé‡è¯•</li>
                                <li>ç¡®è®¤dist/engine-kernel.min.jsæ–‡ä»¶å­˜åœ¨</li>
                            </ul>
                        </div>
                    `;
                }
            }
            
            // å¯åŠ¨æµ‹è¯•
            initTest();
        </script>
    </body>
</html> 