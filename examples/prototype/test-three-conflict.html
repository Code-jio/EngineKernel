<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
        <meta http-equiv="Pragma" content="no-cache" />
        <meta http-equiv="Expires" content="0" />
        <title>THREE对象冲突测试</title>
        <style>
            body { 
                margin: 0; 
                padding: 20px; 
                font-family: Arial, sans-serif;
                background: #f0f0f0;
            }
            .info { 
                background: white; 
                padding: 20px; 
                margin-bottom: 20px; 
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .success { color: #28a745; }
            .error { color: #dc3545; }
            .warning { color: #ffc107; }
            #container { 
                width: 800px; 
                height: 600px; 
                border: 2px solid #ddd;
                border-radius: 8px;
                background: #000;
            }
        </style>
        <script>
            // 在加载其他脚本之前清理可能存在的全局THREE对象
            if (typeof window.THREE !== 'undefined') {
                console.warn('检测到已存在的THREE对象，将被清理以避免冲突');
                delete window.THREE;
            }
        </script>
        <script src="http://localhost:8000/engine-kernel.dev.js"></script>
    </head>
    <body>
        <div class="info">
            <h2>THREE对象冲突检测结果</h2>
            <div id="status">正在检测...</div>
        </div>
        
        <canvas id="container"></canvas>
        
        <script>
            const statusDiv = document.getElementById('status');
            
            function updateStatus(message, type = 'info') {
                const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'warning';
                statusDiv.innerHTML += `<div class="${className}">✓ ${message}</div>`;
            }
            
            try {
                // 检查EngineKernel是否正确加载
                if (!window.EngineKernel) {
                    throw new Error('EngineKernel未正确加载');
                }
                updateStatus('EngineKernel已正确加载', 'success');
                
                // 检查THREE是否可用
                if (!window.EngineKernel.THREE) {
                    throw new Error('EngineKernel.THREE不可用');
                }
                updateStatus('EngineKernel.THREE已正确暴露', 'success');
                
                // 使用本地THREE引用
                const THREE = window.EngineKernel.THREE;
                updateStatus(`THREE版本: ${THREE.REVISION}`, 'success');
                
                // 创建简单的测试场景
                const scene = new THREE.Scene();
                const camera = new THREE.PerspectiveCamera(75, 800/600, 0.1, 1000);
                const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('container') });
                
                renderer.setSize(800, 600);
                renderer.setClearColor(0x222222);
                
                // 创建测试几何体
                const geometry = new THREE.BoxGeometry(2, 2, 2);
                const material = new THREE.MeshBasicMaterial({ 
                    color: 0x00ff88,
                    wireframe: true 
                });
                const cube = new THREE.Mesh(geometry, material);
                scene.add(cube);
                
                // 设置相机位置
                camera.position.z = 5;
                
                updateStatus('3D场景创建成功', 'success');
                
                // 动画循环
                function animate() {
                    requestAnimationFrame(animate);
                    
                    cube.rotation.x += 0.01;
                    cube.rotation.y += 0.01;
                    
                    renderer.render(scene, camera);
                }
                
                animate();
                updateStatus('动画循环启动成功 - 如果你看到旋转的线框立方体，说明THREE对象冲突已解决！', 'success');
                
            } catch (error) {
                updateStatus(`错误: ${error.message}`, 'error');
                console.error('THREE对象检测失败:', error);
            }
        </script>
    </body>
</html> 