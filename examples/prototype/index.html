<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>EngineKernel 原型验证</title>
        <link rel="stylesheet" href="./index.css">
    </head>
    <body>
        <div class="control-panel">
            <button id="switchPerspective">透视相机</button>
            <button id="switchOrtho">正交相机</button>
            <div id="fpsCounter"></div>
        </div>
        <div id="viewport"></div>

        <!-- <script src="./dev.js"></script> -->
        <script src="http://localhost:8080/engine-kernel.dev.js"></script>
        <script>
            const engine = new EngineKernel.Core({
                container: "#viewport",
                plugins: [
                    new EngineKernel.CameraPlugin({ name: "CameraPlugin", path: "/plugins/camera" }),
                    new EngineKernel.ResourceReaderPlugin({
                        name: "ResourceReader",
                        path: "/plugins/resource-reader",
                        basePath: "/assets/models",
                        url: "/assets/models",
                        supportedFormats: ["gltf", "fbx"],
                    }),
                    EngineKernel.PluginManager,
                ],
            })

            const scene = new EngineKernel.BaseScene({
                name: "BaseScene",
                path: "/plugins/scene",
                container: "#viewport",
                userData: {
                    cameraConfig: {
                        type: "perspective",
                        fov: 45,
                        near: 0.1,
                        far: 1000,
                        position: [0, 0, 5],
                        lookAt: [0, 0, 0],
                    },
                },
            })
            engine.registerPlugin(scene)

            console.log("EngineKernel 实例:", engine) // 打印 EngineKernel 实例

            engine.eventBus.on("init-complete", () => {
                console.log("场景初始化完成，当前场景对象:", engine.getPlugin("BaseScene"))

                console.log("场景初始化完成，当前场景对象:", engine.getPlugin("BaseScene").currentScene)
                // const glMonitor = new EngineKernel.GLMonitor({
                //     name: "GLMonitor",
                //     path: "/plugins/gl-monitor",
                //     userData: {
                //         renderer: engine.getPlugin('BaseScene').renderer
                //     },
                //     displayElement: "#fpsCounter",
                //     updateInterval: 1000,
                // })
                // engine.registerPlugin(glMonitor)
            })

            // 相机切换控制
            document.getElementById("switchPerspective").onclick = () => {
                engine.getPlugin("CameraService").switchType("perspective")
            }
            document.getElementById("switchOrtho").onclick = () => {
                engine.getPlugin("CameraService").switchType("orthographic")
            }
        </script>
    </body>
</html>
