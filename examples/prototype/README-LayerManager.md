# LayerManager æ¼”ç¤ºè¯´æ˜

## ğŸ¯ æ¼”ç¤ºæ¦‚è¿°

è¿™ä¸ªæ¼”ç¤ºå±•ç¤ºäº†å¦‚ä½•åœ¨3Då¼•æ“ä¸­ä½¿ç”¨LayerManageræ’ä»¶æ¥ç®¡ç†åœºæ™¯ä¸­çš„ä¸åŒå¯¹è±¡ã€‚

## ğŸ¬ æ¼”ç¤ºå†…å®¹

### è‡ªåŠ¨æ¼”ç¤ºå¯¹è±¡

1. **çº¢è‰²ç«‹æ–¹ä½“** - æ·»åŠ åˆ°åŸºç¡€æ¨¡å‹å›¾å±‚
2. **é’è‰²çƒä½“** - æ·»åŠ åˆ°æ¨¡å‹æ ‡æ³¨å›¾å±‚  
3. **é©¬æ¨¡å‹** - æ·»åŠ åˆ°è‡ªå®šä¹‰åŠ¨ç‰©æ¨¡å‹å›¾å±‚
4. **æ–‡å­—æ ‡ç­¾ç²¾çµ** - æ·»åŠ åˆ°ç²¾çµå›¾å±‚

### è‡ªåŠ¨æ¼”ç¤ºåºåˆ—

ç¨‹åºä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ¼”ç¤ºï¼š

- **3ç§’å** - éšè—æ¨¡å‹æ ‡æ³¨å›¾å±‚ï¼ˆé’è‰²çƒä½“æ¶ˆå¤±ï¼‰
- **6ç§’å** - æ˜¾ç¤ºæ¨¡å‹æ ‡æ³¨å›¾å±‚ï¼ˆé’è‰²çƒä½“é‡æ–°å‡ºç°ï¼‰
- **9ç§’å** - è®¾ç½®åŠ¨ç‰©å›¾å±‚é€æ˜åº¦ä¸º50%
- **12ç§’å** - æ¢å¤åŠ¨ç‰©å›¾å±‚é€æ˜åº¦ä¸º100%
- **15ç§’å** - éšè—ç²¾çµå›¾å±‚ï¼ˆæ–‡å­—æ ‡ç­¾æ¶ˆå¤±ï¼‰
- **18ç§’å** - æ˜¾ç¤ºç²¾çµå›¾å±‚ï¼ˆæ–‡å­—æ ‡ç­¾é‡æ–°å‡ºç°ï¼‰
- **21ç§’å** - æ˜¾ç¤ºå›¾å±‚ç»Ÿè®¡ä¿¡æ¯

## ğŸ¹ äº¤äº’æ§åˆ¶

### é”®ç›˜æ§åˆ¶

| æŒ‰é”® | åŠŸèƒ½ |
|------|------|
| `1` | åˆ‡æ¢åŸºç¡€æ¨¡å‹å›¾å±‚ï¼ˆçº¢è‰²ç«‹æ–¹ä½“ï¼‰|
| `2` | åˆ‡æ¢æ¨¡å‹æ ‡æ³¨å›¾å±‚ï¼ˆé’è‰²çƒä½“ï¼‰|
| `3` | åˆ‡æ¢ç²¾çµå›¾å±‚ï¼ˆæ–‡å­—æ ‡ç­¾ï¼‰|
| `4` | åˆ‡æ¢åŠ¨ç‰©æ¨¡å‹å›¾å±‚ï¼ˆé©¬æ¨¡å‹ï¼‰|
| `S` | æ˜¾ç¤ºå›¾å±‚ç»Ÿè®¡ä¿¡æ¯ |
| `H` | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ |

### é¼ æ ‡æ§åˆ¶

- **å·¦é”®æ‹–æ‹½** - æ—‹è½¬è§†è§’
- **å³é”®æ‹–æ‹½** - å¹³ç§»è§†è§’
- **æ»šè½®** - ç¼©æ”¾è§†è§’

## ğŸ­ å›¾å±‚ç±»å‹è¯´æ˜

### é¢„å®šä¹‰å›¾å±‚ç±»å‹

1. **BASE_SCENE** (æ¸²æŸ“é¡ºåº: 0) - åŸºç¡€åœºæ™¯å…ƒç´ 
2. **BASE_MODEL** (æ¸²æŸ“é¡ºåº: 100) - åŸºç¡€3Dæ¨¡å‹
3. **MODEL_ANNOTATION** (æ¸²æŸ“é¡ºåº: 200) - 3Dæ¨¡å‹æ ‡æ³¨
4. **SPRITE** (æ¸²æŸ“é¡ºåº: 300) - 2Dç²¾çµå›¾
5. **CSS3D** (æ¸²æŸ“é¡ºåº: 400) - HTMLå…ƒç´ 3DåŒ–
6. **IMAGE_ANNOTATION** (æ¸²æŸ“é¡ºåº: 500) - å›¾ç‰‡æ ‡æ³¨
7. **CUSTOM** (è‡ªå®šä¹‰) - ç”¨æˆ·è‡ªå®šä¹‰å›¾å±‚

## ğŸ” è§‚å¯Ÿè¦ç‚¹

### æ§åˆ¶å°è¾“å‡º

æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„æ§åˆ¶å°ï¼Œå¯ä»¥çœ‹åˆ°ï¼š

- å›¾å±‚åˆ›å»ºæ—¥å¿—
- å›¾å±‚æ“ä½œæ—¥å¿—
- é”®ç›˜äº¤äº’åé¦ˆ
- å›¾å±‚ç»Ÿè®¡ä¿¡æ¯

### è§†è§‰æ•ˆæœ

- è§‚å¯Ÿä¸åŒå›¾å±‚å¯¹è±¡çš„æ˜¾ç¤º/éšè—
- æ³¨æ„é€æ˜åº¦å˜åŒ–æ•ˆæœ
- è§‚å¯Ÿæ¸²æŸ“é¡ºåºçš„å½±å“

## ğŸ’¡ æŠ€æœ¯è¦ç‚¹

### LayerManagerç‰¹æ€§

1. **è‡ªåŠ¨å›¾å±‚ç®¡ç†** - é»˜è®¤åˆ›å»º6ç§é¢„å®šä¹‰å›¾å±‚
2. **å±‚çº§ç»“æ„** - æ”¯æŒçˆ¶å­å›¾å±‚å…³ç³»
3. **æ¸²æŸ“é¡ºåº** - é€šè¿‡renderOrderæ§åˆ¶æ¸²æŸ“ä¼˜å…ˆçº§
4. **æ‰¹é‡æ“ä½œ** - æŒ‰ç±»å‹æ‰¹é‡æ˜¾ç¤º/éšè—å›¾å±‚
5. **äº‹ä»¶ç³»ç»Ÿ** - å›¾å±‚æ“ä½œä¼šè§¦å‘ç›¸åº”äº‹ä»¶
6. **èµ„æºç®¡ç†** - è‡ªåŠ¨æ¸…ç†THREE.jså¯¹è±¡

### æ€§èƒ½ä¼˜åŒ–

- ä½¿ç”¨å›¾å±‚æ‰¹é‡æ§åˆ¶å¯è§æ€§ï¼Œæå‡æ€§èƒ½
- æŒ‰éœ€æ˜¾ç¤ºå¤æ‚å¯¹è±¡ï¼Œé™ä½æ¸²æŸ“è´Ÿæ‹…
- é€šè¿‡é€æ˜åº¦æ§åˆ¶å®ç°æ¸å˜æ•ˆæœ

## ğŸš€ æ‰©å±•å»ºè®®

### è‡ªå®šä¹‰å›¾å±‚

```javascript
// åˆ›å»ºLODå›¾å±‚ç»„
const lodGroup = layerManager.createLayer({
    id: 'lod-group',
    name: 'LODå›¾å±‚ç»„',
    type: EngineKernel.LayerType.CUSTOM,
    renderOrder: 120
})

// åˆ›å»ºä¸åŒç²¾åº¦çš„å­å›¾å±‚
['high', 'medium', 'low'].forEach((level, index) => {
    layerManager.createLayer({
        id: `lod-${level}`,
        name: `LOD-${level}`,
        type: EngineKernel.LayerType.BASE_MODEL,
        parent: 'lod-group',
        renderOrder: 120 + index,
        visible: index === 0 // åªæ˜¾ç¤ºé«˜ç²¾åº¦
    })
})
```

### è·ç¦»æ§åˆ¶

```javascript
// æ ¹æ®ç›¸æœºè·ç¦»æ§åˆ¶å›¾å±‚æ˜¾ç¤º
function updateLODByDistance(cameraPosition) {
    const distance = cameraPosition.length()
    
    if (distance > 2000) {
        layerManager.hideLayersByType(EngineKernel.LayerType.MODEL_ANNOTATION)
    } else {
        layerManager.showLayersByType(EngineKernel.LayerType.MODEL_ANNOTATION)
    }
}
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **å›¾å±‚ä¸æ˜¾ç¤º** - æ£€æŸ¥å›¾å±‚å¯è§æ€§å’Œæ¸²æŸ“é¡ºåº
2. **æ¨¡å‹åŠ è½½å¤±è´¥** - ç¡®è®¤æ¨¡å‹æ–‡ä»¶è·¯å¾„æ­£ç¡®
3. **é”®ç›˜æ§åˆ¶æ— æ•ˆ** - ç¡®ä¿é¡µé¢å·²è·å¾—ç„¦ç‚¹

### è°ƒè¯•æŠ€å·§

```javascript
// æ‰“å°æ‰€æœ‰å›¾å±‚ä¿¡æ¯
layerManager.getAllLayers().forEach(layer => {
    console.log(`å›¾å±‚: ${layer.name}, å¯è§: ${layer.visible}, å¯¹è±¡æ•°: ${layer.group.children.length}`)
})

// æ£€æŸ¥å›¾å±‚ç»Ÿè®¡
console.log(layerManager.getLayerStats())
```

è¿™ä¸ªæ¼”ç¤ºå……åˆ†å±•ç¤ºäº†LayerManagerçš„å¼ºå¤§åŠŸèƒ½ï¼Œæ˜¯å­¦ä¹ 3Dåœºæ™¯å›¾å±‚ç®¡ç†çš„ç»ä½³ç¤ºä¾‹ï¼ 