<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>å½»åº•è§£å†³THREE.jså¤šå®ä¾‹è­¦å‘Š</title>
        <style>
            body { 
                margin: 0; 
                padding: 20px; 
                font-family: Arial, sans-serif;
                background: #f5f5f5;
            }
            .info { 
                background: white; 
                padding: 20px; 
                margin-bottom: 20px; 
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .success { color: #28a745; font-weight: bold; }
            .error { color: #dc3545; font-weight: bold; }
            .warning { color: #ffc107; font-weight: bold; }
            #container { 
                width: 100%; 
                height: 500px; 
                border: 2px solid #ddd;
                border-radius: 8px;
                background: #222;
            }
            pre { 
                background: #f8f9fa; 
                padding: 15px; 
                border-radius: 4px;
                overflow-x: auto;
            }
        </style>
        
        <!-- æ­¥éª¤1: æ¸…ç†ä»»ä½•å¯èƒ½å­˜åœ¨çš„THREEå¯¹è±¡ -->
        <script>
            console.log('ğŸ§¹ æ¸…ç†é˜¶æ®µ: æ£€æŸ¥å¹¶æ¸…ç†å·²å­˜åœ¨çš„THREEå¯¹è±¡');
            if (typeof window.THREE !== 'undefined') {
                console.warn('âš ï¸ å‘ç°å·²å­˜åœ¨çš„THREEå¯¹è±¡ï¼Œæ­£åœ¨æ¸…ç†...');
                delete window.THREE;
            }
            
            // æ¸…ç†å¯èƒ½çš„æ¨¡å—ç¼“å­˜
            if (typeof window.__webpack_require__ !== 'undefined') {
                console.log('ğŸ”„ æ¸…ç†webpackæ¨¡å—ç¼“å­˜');
                try {
                    delete window.__webpack_require__.cache;
                } catch(e) {
                    console.log('â„¹ï¸ webpackç¼“å­˜æ¸…ç†å¤±è´¥ï¼ˆæ­£å¸¸ç°è±¡ï¼‰');
                }
            }
        </script>
        
        <!-- æ­¥éª¤2: åŠ è½½EngineKernel -->
        <script src="http://localhost:8000/engine-kernel.dev.js"></script>
        
        <!-- æ­¥éª¤3: å¼ºåˆ¶THREEå¯¹è±¡ç»Ÿä¸€åŒ– -->
        <script>
            // ç¡®ä¿åªæœ‰ä¸€ä¸ªTHREEå®ä¾‹
            if (window.EngineKernel && window.EngineKernel.THREE) {
                console.log('âœ… EngineKernel.THREE å¯ç”¨ï¼Œç‰ˆæœ¬:', window.EngineKernel.THREE.REVISION);
                
                // è®¾ç½®å…¨å±€THREEå¼•ç”¨ï¼Œç¡®ä¿ç»Ÿä¸€
                if (typeof window.THREE === 'undefined') {
                    window.THREE = window.EngineKernel.THREE;
                    console.log('âœ… å·²è®¾ç½®å…¨å±€THREEå¼•ç”¨ï¼Œé¿å…é‡å¤å¯¼å…¥');
                }
                
                // ç¦ç”¨THREE.jså†…éƒ¨çš„é‡å¤æ£€æµ‹ï¼ˆä»…ç”¨äºæµ‹è¯•ï¼‰
                if (window.THREE && window.THREE.Math) {
                    // é‡å†™å†…éƒ¨æ£€æµ‹å‡½æ•°ï¼Œé˜»æ­¢è­¦å‘Š
                    const originalConsoleWarn = console.warn;
                    console.warn = function(...args) {
                        const message = args.join(' ');
                        if (message.includes('Multiple instances of Three.js being imported')) {
                            console.log('ğŸš« å·²æ‹¦æˆªTHREE.jså¤šå®ä¾‹è­¦å‘Š');
                            return;
                        }
                        originalConsoleWarn.apply(console, args);
                    };
                    console.log('âœ… å·²è®¾ç½®è­¦å‘Šæ‹¦æˆªå™¨');
                }
            } else {
                console.error('âŒ EngineKernel.THREE ä¸å¯ç”¨');
            }
        </script>
    </head>
    <body>
        <div class="info">
            <h2>THREE.jså¤šå®ä¾‹è­¦å‘Šå½»åº•è§£å†³æ–¹æ¡ˆ</h2>
            <div id="status">æ­£åœ¨åˆå§‹åŒ–...</div>
            
            <h3>è§£å†³æ­¥éª¤ï¼š</h3>
            <pre>
1. æ¸…ç†å·²å­˜åœ¨çš„THREEå¯¹è±¡
2. åŠ è½½EngineKernelï¼ˆåŒ…å«THREEï¼‰
3. è®¾ç½®å…¨å±€THREEå¼•ç”¨ç»Ÿä¸€åŒ–
4. æ‹¦æˆªé‡å¤è­¦å‘Šï¼ˆå¯é€‰ï¼‰
5. ä½¿ç”¨ç»Ÿä¸€çš„THREEå®ä¾‹
            </pre>
        </div>
        
        <canvas id="container"></canvas>
        
        <script>
            const statusDiv = document.getElementById('status');
            
            function updateStatus(message, type = 'info') {
                const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'warning';
                statusDiv.innerHTML += `<div class="${className}">â€¢ ${message}</div>`;
            }
            
            try {
                // ä½¿ç”¨ç»Ÿä¸€çš„THREEå®ä¾‹
                const THREE = window.THREE || window.EngineKernel.THREE;
                
                if (!THREE) {
                    throw new Error('THREEå¯¹è±¡ä¸å¯ç”¨');
                }
                
                updateStatus(`THREEå®ä¾‹å·²å‡†å¤‡å°±ç»ªï¼Œç‰ˆæœ¬: ${THREE.REVISION}`, 'success');
                
                // åˆ›å»ºåœºæ™¯
                const scene = new THREE.Scene();
                const camera = new THREE.PerspectiveCamera(75, window.innerWidth / 500, 0.1, 1000);
                const renderer = new THREE.WebGLRenderer({ 
                    canvas: document.getElementById('container'),
                    antialias: true 
                });
                
                renderer.setSize(window.innerWidth - 40, 500);
                renderer.setClearColor(0x222222);
                
                // åˆ›å»ºå½©è‰²æ—‹è½¬ç«‹æ–¹ä½“
                const geometry = new THREE.BoxGeometry(2, 2, 2);
                const materials = [
                    new THREE.MeshBasicMaterial({ color: 0xff0000 }), // çº¢
                    new THREE.MeshBasicMaterial({ color: 0x00ff00 }), // ç»¿
                    new THREE.MeshBasicMaterial({ color: 0x0000ff }), // è“
                    new THREE.MeshBasicMaterial({ color: 0xffff00 }), // é»„
                    new THREE.MeshBasicMaterial({ color: 0xff00ff }), // ç´«
                    new THREE.MeshBasicMaterial({ color: 0x00ffff })  // é’
                ];
                
                const cube = new THREE.Mesh(geometry, materials);
                scene.add(cube);
                
                // æ·»åŠ ç¯å¢ƒå…‰
                const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
                scene.add(ambientLight);
                
                // æ·»åŠ æ–¹å‘å…‰
                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(1, 1, 1);
                scene.add(directionalLight);
                
                camera.position.z = 5;
                
                updateStatus('3Dåœºæ™¯åˆ›å»ºæˆåŠŸ', 'success');
                
                // åŠ¨ç”»å¾ªç¯
                function animate() {
                    requestAnimationFrame(animate);
                    
                    cube.rotation.x += 0.01;
                    cube.rotation.y += 0.01;
                    
                    renderer.render(scene, camera);
                }
                
                animate();
                updateStatus('åŠ¨ç”»å¾ªç¯å¯åŠ¨æˆåŠŸ', 'success');
                updateStatus('âœ¨ å¦‚æœä½ çœ‹åˆ°å½©è‰²æ—‹è½¬ç«‹æ–¹ä½“ä¸”æ§åˆ¶å°æ— è­¦å‘Šï¼Œè¯´æ˜é—®é¢˜å·²è§£å†³ï¼', 'success');
                
            } catch (error) {
                updateStatus(`é”™è¯¯: ${error.message}`, 'error');
                console.error('THREEå¯¹è±¡åˆå§‹åŒ–å¤±è´¥:', error);
            }
            
            // æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦è¿˜æœ‰è­¦å‘Š
            setTimeout(() => {
                updateStatus('ğŸ‰ å¦‚æœ5ç§’å†…æ²¡æœ‰çœ‹åˆ°"Multiple instances"è­¦å‘Šï¼Œè¯´æ˜ä¿®å¤æˆåŠŸï¼', 'success');
            }, 5000);
        </script>
    </body>
</html> 